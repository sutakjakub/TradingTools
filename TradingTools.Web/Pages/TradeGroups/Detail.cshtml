@page "{id:long}"
@model TradingTools.Web.Pages.TradeGroupDetail.DetailModel
@{
}

<style scoped>
    .table.summary {
        width: 50%;
    }
        .table.summary tr {
            line-height: 10px;
            min-height: 10px;
            height: 10px;
        }

    .table.summary td {
        white-space: nowrap;
        width: 1%;
    }
</style>

<div>
    <h1>
        @Model.ViewModel.TradeGroup.Name
    </h1>
    <h4>@Model.ViewModel.TradeGroup.SymbolInfo?.Symbol</h4>
    <table class="table table-hover small summary">
        <tbody>
            <tr>
                <td>Buy Quantity</td>
                <td>@Model.ViewModel.BuyQuantity @Model.ViewModel.TradeGroup.SymbolInfo?.BaseAsset</td>
            </tr>
            <tr>
                <td>Sell Quantity</td>
                <td>@Model.ViewModel.SellQuantity @Model.ViewModel.TradeGroup.SymbolInfo?.BaseAsset</td>
            </tr>
            <tr>
                <td>Average Buy Price</td>
                <td>@Model.ViewModel.AverageBuyPrice @Model.ViewModel.TradeGroup.SymbolInfo?.QuoteAsset</td>
            </tr>
            <tr>
                <td>Average Sell Price</td>
                <td>@Model.ViewModel.AverageSellPrice @Model.ViewModel.TradeGroup.SymbolInfo?.QuoteAsset</td>
            </tr>
            <tr>
                <td>Average Cost</td>
                <td>@Model.ViewModel.AverageCost @Model.ViewModel.TradeGroup.SymbolInfo?.QuoteAsset</td>
            </tr>
            <tr>
                <td>Gain/Loss</td>
                <td>
                    @if (@Model.ViewModel.Gain >= 0)
                    {
                    <span class="bg-success text-light pl-2 pr-2">@Model.ViewModel.GainString</span>
                    }
                    else
                    {
                    <span class="bg-danger text-light pl-2 pr-2">@Model.ViewModel.GainString</span>
                    }
                    
                </td>
            </tr>
            <tr>
                <td>Remaing Position</td>
                <td>@Model.ViewModel.RemaingPositionPercentageString</td>
            </tr>
        </tbody>
    </table>
</div>

<form asp-page-handler="sync" method="post">
    <input type="hidden" name="groupId" value="@Model.ViewModel.TradeGroup.Id" />
    <input type="hidden" name="symbol" value="@Model.ViewModel.TradeGroup.SymbolInfo?.Symbol" />
    <input type="hidden" name="baseAsset" value="@Model.ViewModel.TradeGroup.BaseAsset" />
    <button class="btn btn-primary">Sync</button>
</form>

<table class="table table-hover">
    <thead>
        <tr>
            <th>Date</th>
            <th>Symbol</th>
            <th>Side</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Quote Quantity</th>
            <th>Commission</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var trade in Model.ViewModel.TradeGroup.Trades)
        {
            <tr>
                <td><div class="d-block"><span>@trade.TradeTime.ToString("u")</span> <span class="small">@(Math.Round((@DateTime.Now - @trade.TradeTime).TotalDays))(days ago)</span></div></td>
                <td>@trade.Symbol</td>
                <td>
                    @if (@trade.IsBuyer)
                    {
                        <span class="bg-success text-light pl-2 pr-2">BUY</span>
                    }
                    else
                    {
                        <span class="bg-danger text-light pl-2 pr-2">SELL</span>
                    }
                </td>
                <td>@trade.Price @trade.T2SymbolInfo.QuoteAsset</td>
                <td>@trade.Quantity @trade.T2SymbolInfo.BaseAsset</td>
                <td>@trade.QuoteQuantity @trade.T2SymbolInfo.QuoteAsset</td>
                <td>@trade.Commission @trade.CommissionAsset</td>
            </tr>
        }
    </tbody>
</table>

@if (@Model.OutsideTrades?.Any() == true)
{
    <form asp-page-handler="assign" method="post">
        <input type="hidden" name="id" value="@Model.ViewModel.TradeGroup.Id" />
        <button class="btn btn-primary">Assign to group</button>
        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    <th>TradeTime</th>
                    <th>TradeGroup</th>
                    <th>Symbol</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>QuoteQuantity</th>
                    <th>Commission</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var trade in Model.OutsideTrades)
                {
                    <tr>
                        <td><input name="AreChecked" type="checkbox" value="@trade.Id" /></td>
                        <td>@trade.TradeTime</td>
                        <td><a asp-page="/TradeGroups/Detail" asp-route-id="@trade.T2TradeGroup.Id">@trade.T2TradeGroup.Name</a></td>
                        <td>@trade.Symbol</td>
                        <td>@trade.Price @trade.T2SymbolInfo.QuoteAsset</td>
                        <td>@trade.Quantity</td>
                        <td>@trade.QuoteQuantity</td>
                        <td>@trade.Commission @trade.CommissionAsset</td>
                    </tr>
                }
            </tbody>
        </table>
    </form>
}

